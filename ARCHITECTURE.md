# ğŸ—ï¸ Architecture & Data Flow - Video Uploader

> HÆ°á»›ng dáº«n chi tiáº¿t vá» luá»“ng hoáº¡t Ä‘á»™ng tá»« **Page** â†’ **Component** â†’ **Hook** â†’ **Lib**

---

## ğŸ“Š Tá»•ng quan kiáº¿n trÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER BROWSER                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. PAGE LAYER (app/upload/page.tsx)                        â”‚
â”‚     - Route handler                                          â”‚
â”‚     - State management cho page-level                        â”‚
â”‚     - Orchestrate components                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. COMPONENT LAYER (components/upload/*)                   â”‚
â”‚     - UI presentation                                        â”‚
â”‚     - User interactions                                      â”‚
â”‚     - Local component state                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. HOOK LAYER (lib/hooks.ts)                               â”‚
â”‚     - Business logic                                         â”‚
â”‚     - Shared state management                                â”‚
â”‚     - Side effects (upload, autosave, etc.)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. LIB/UTILS LAYER (lib/utils.ts)                          â”‚
â”‚     - Pure functions                                         â”‚
â”‚     - Helpers & utilities                                    â”‚
â”‚     - No side effects                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Luá»“ng hoáº¡t Ä‘á»™ng chi tiáº¿t

### **Luá»“ng hoÃ n chá»‰nh: Upload Video tá»« A Ä‘áº¿n Z**

#### **Phase 1: Khá»Ÿi táº¡o vÃ  Chá»n File**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER VISITS /upload                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. PAGE COMPONENT RENDERS (app/upload/page.tsx)                â”‚
â”‚    - Initialize state:                                          â”‚
â”‚      â€¢ selectedFile: null                                       â”‚
â”‚      â€¢ modalOpen: false                                         â”‚
â”‚    - Render UploadDropzone component                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. UPLOAD DROPZONE READY (components/upload/UploadDropzone.tsx)â”‚
â”‚    - Shows drag & drop zone                                     â”‚
â”‚    - "Drop your videos here" text                               â”‚
â”‚    - "Choose Videos" button                                     â”‚
â”‚    - File info: "Supports MP4, MOV, AVI. Max file size: 5GB"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. USER ACTION - Drag file hoáº·c Click button                   â”‚
â”‚    A. Drag & Drop:                                              â”‚
â”‚       - User drags video.mp4 over dropzone                      â”‚
â”‚       - onDragEnter â†’ setIsDragging(true)                       â”‚
â”‚       - Border changes to blue, shows animation                 â”‚
â”‚       - onDrop â†’ captures file from e.dataTransfer.files        â”‚
â”‚                                                                 â”‚
â”‚    B. Click to Select:                                          â”‚
â”‚       - User clicks "Choose Videos" button                      â”‚
â”‚       - Opens file picker dialog                                â”‚
â”‚       - User selects video.mp4                                  â”‚
â”‚       - onChange event captures file from input                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. FILE VALIDATION (UploadDropzone â†’ lib/utils.ts)             â”‚
â”‚    processFiles([video.mp4])                                    â”‚
â”‚         â†“                                                       â”‚
â”‚    validateVideoFile(file, maxSizeBytes)                        â”‚
â”‚         â†“                                                       â”‚
â”‚    Checks:                                                      â”‚
â”‚    âœ“ Is file type video/*? â†’ YES                               â”‚
â”‚    âœ“ Is size < 5GB? â†’ YES                                      â”‚
â”‚         â†“                                                       â”‚
â”‚    Returns: { valid: true }                                     â”‚
â”‚         â†“                                                       â”‚
â”‚    onFilesSelected([video.mp4]) // Callback to page            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. PAGE RECEIVES FILE (app/upload/page.tsx)                    â”‚
â”‚    handleFilesSelected(files)                                   â”‚
â”‚         â†“                                                       â”‚
â”‚    setSelectedFile(files[0]) // video.mp4                       â”‚
â”‚    setModalOpen(true)                                           â”‚
â”‚         â†“                                                       â”‚
â”‚    State updated â†’ Component re-renders                         â”‚
â”‚         â†“                                                       â”‚
â”‚    UploadModal renders with props:                              â”‚
â”‚    - open={true}                                                â”‚
â”‚    - videoFile={video.mp4}                                      â”‚
â”‚    - onCancel={handleModalClose}                                â”‚
â”‚    - onComplete={handleComplete}                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 2: Modal Initialization & Upload Start**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. UPLOAD MODAL MOUNTS (components/upload/UploadModal.tsx)     â”‚
â”‚    Component initialization:                                    â”‚
â”‚    - currentStep = 1 (DETAILS)                                  â”‚
â”‚    - videoUrl = null                                            â”‚
â”‚    - videoDuration = 0                                          â”‚
â”‚    - metadata = { title: "", description: "", tags: [], ... }   â”‚
â”‚    - errors = {}                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. HOOKS INITIALIZATION                                         â”‚
â”‚                                                                 â”‚
â”‚    A. useAutosave Hook (lib/hooks.ts)                           â”‚
â”‚       const { saveDraft, loadDraft, clearDraft, hasDraft }     â”‚
â”‚             = useAutosave("video-upload-draft")                 â”‚
â”‚       â†“                                                         â”‚
â”‚       Check localStorage for existing draft:                    â”‚
â”‚       - hasDraft() checks if key exists                         â”‚
â”‚       - If found: prompt "Restore draft?" â†’ loadDraft()         â”‚
â”‚       - Load previous metadata into state                       â”‚
â”‚                                                                 â”‚
â”‚    B. useUploadProgress Hook (lib/hooks.ts)                     â”‚
â”‚       const uploadState = useUploadProgress()                   â”‚
â”‚       Initial state:                                            â”‚
â”‚       {                                                         â”‚
â”‚         uploadProgress: 0,                                      â”‚
â”‚         processingStatus: "idle",                               â”‚
â”‚         uploadId: null,                                         â”‚
â”‚         videoId: null,                                          â”‚
â”‚         error: null                                             â”‚
â”‚       }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. VIDEO OBJECT URL CREATION                                    â”‚
â”‚    useEffect(() => {                                            â”‚
â”‚      if (videoFile) {                                           â”‚
â”‚        const url = URL.createObjectURL(videoFile)               â”‚
â”‚        setVideoUrl(url)                                         â”‚
â”‚        uploadState.startUpload(videoFile)                       â”‚
â”‚                                                                 â”‚
â”‚        return () => URL.revokeObjectURL(url) // Cleanup         â”‚
â”‚      }                                                          â”‚
â”‚    }, [videoFile])                                              â”‚
â”‚                                                                 â”‚
â”‚    Result:                                                      â”‚
â”‚    - videoUrl = "blob:http://localhost:3000/abc-123"            â”‚
â”‚    - Upload simulation starts                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. UPLOAD SIMULATION STARTS (useUploadProgress hook)          â”‚
â”‚     startUpload(file)                                           â”‚
â”‚         â†“                                                       â”‚
â”‚     Generate uploadId = "upload_1730678400000"                  â”‚
â”‚         â†“                                                       â”‚
â”‚     setState({                                                  â”‚
â”‚       processingStatus: "uploading",                            â”‚
â”‚       uploadProgress: 0,                                        â”‚
â”‚       uploadId: "upload_1730678400000"                          â”‚
â”‚     })                                                          â”‚
â”‚         â†“                                                       â”‚
â”‚     setInterval (500ms):                                        â”‚
â”‚       progress += random(0-15)                                  â”‚
â”‚       setState({ uploadProgress: progress })                    â”‚
â”‚         â†“                                                       â”‚
â”‚     When progress >= 100:                                       â”‚
â”‚       clearInterval()                                           â”‚
â”‚       â†“                                                         â”‚
â”‚       setTimeout 500ms â†’ processingStatus = "queued"            â”‚
â”‚                          videoId = "video_1730678401000"        â”‚
â”‚       â†“                                                         â”‚
â”‚       setTimeout 2000ms â†’ processingStatus = "processing"       â”‚
â”‚       â†“                                                         â”‚
â”‚       setTimeout 3000ms â†’ processingStatus = "ready"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 3: Step 1 - Details (Metadata Form)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. MODAL RENDERS STEP 1 - DETAILS                             â”‚
â”‚                                                                 â”‚
â”‚     Layout (2-column grid):                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  LEFT COLUMN        â”‚  RIGHT COLUMN       â”‚              â”‚
â”‚     â”‚  (Video Preview)    â”‚  (Metadata Form)    â”‚              â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚     â”‚ VideoPreviewPlayer  â”‚ MetadataForm        â”‚              â”‚
â”‚     â”‚ - Shows video       â”‚ - Title input       â”‚              â”‚
â”‚     â”‚ - 9:16 aspect ratio â”‚ - Description       â”‚              â”‚
â”‚     â”‚ - HD badge          â”‚ - Tags input        â”‚              â”‚
â”‚     â”‚ - Duration overlay  â”‚ - Category select   â”‚              â”‚
â”‚     â”‚                     â”‚ - Language select   â”‚              â”‚
â”‚     â”‚ ProcessingStatus    â”‚ - Allow comments âœ“  â”‚              â”‚
â”‚     â”‚ - "Uploading... 45%"â”‚ - Add to playlist   â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚     Header:                                                     â”‚
â”‚     - "Upload Video" title                                      â”‚
â”‚     - Language switcher: [EN] [VI]                              â”‚
â”‚     - Tab navigation: [1 Details] [2 Elements] [3 Checks] ...  â”‚
â”‚                                                                 â”‚
â”‚     Footer:                                                     â”‚
â”‚     - "Save Draft" button (left)                                â”‚
â”‚     - "Next" button (right, disabled if title empty)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. USER FILLS METADATA FORM                                    â”‚
â”‚                                                                 â”‚
â”‚     A. Title Input:                                             â”‚
â”‚        User types: "Amazing Cooking Tutorial"                   â”‚
â”‚        â†“                                                        â”‚
â”‚        onChange event                                           â”‚
â”‚        â†“                                                        â”‚
â”‚        handleChange("title", "Amazing Cooking Tutorial")        â”‚
â”‚        â†“                                                        â”‚
â”‚        Parent onChange callback                                 â”‚
â”‚        â†“                                                        â”‚
â”‚        setMetadata({ ...metadata, title: "Amazing..." })        â”‚
â”‚        â†“                                                        â”‚
â”‚        Component re-renders with new value                      â”‚
â”‚        â†“                                                        â”‚
â”‚        Character counter updates: "28/100"                      â”‚
â”‚        â†“                                                        â”‚
â”‚        "Next" button becomes enabled                            â”‚
â”‚                                                                 â”‚
â”‚     B. Description Input:                                       â”‚
â”‚        User types: "Learn how to cook delicious pasta..."       â”‚
â”‚        â†“                                                        â”‚
â”‚        Same flow as title                                       â”‚
â”‚        â†“                                                        â”‚
â”‚        Counter updates: "45/5000"                               â”‚
â”‚                                                                 â”‚
â”‚     C. Tags Input:                                              â”‚
â”‚        User types: "cooking" + Enter                            â”‚
â”‚        â†“                                                        â”‚
â”‚        handleTagKeyDown detects Enter                           â”‚
â”‚        â†“                                                        â”‚
â”‚        addTag("cooking")                                        â”‚
â”‚        â†“                                                        â”‚
â”‚        tags array: ["cooking"]                                  â”‚
â”‚        â†“                                                        â”‚
â”‚        Renders chip: "#cooking" with Ã— button                   â”‚
â”‚        â†“                                                        â”‚
â”‚        User clicks suggested tag "#tutorial"                    â”‚
â”‚        â†“                                                        â”‚
â”‚        tags array: ["cooking", "tutorial"]                      â”‚
â”‚                                                                 â”‚
â”‚     D. Category & Language:                                     â”‚
â”‚        User selects: category="education", language="en"        â”‚
â”‚        â†“                                                        â”‚
â”‚        Updates metadata state                                   â”‚
â”‚                                                                 â”‚
â”‚     E. Toggles:                                                 â”‚
â”‚        User checks "Allow comments" = true                      â”‚
â”‚        User unchecks "Add to playlist" = false                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. AUTO-SAVE TRIGGERED                                         â”‚
â”‚     useEffect(() => {                                           â”‚
â”‚       if (open && metadata.title) {                             â”‚
â”‚         const timer = setTimeout(() => {                        â”‚
â”‚           saveDraft(metadata)                                   â”‚
â”‚         }, 2000)                                                â”‚
â”‚         return () => clearTimeout(timer)                        â”‚
â”‚       }                                                         â”‚
â”‚     }, [metadata, open])                                        â”‚
â”‚         â†“                                                       â”‚
â”‚     After 2 seconds of inactivity:                              â”‚
â”‚         â†“                                                       â”‚
â”‚     saveDraft(metadata) from useAutosave hook                   â”‚
â”‚         â†“                                                       â”‚
â”‚     localStorage.setItem("video-upload-draft", JSON.stringify({ â”‚
â”‚       ...metadata,                                              â”‚
â”‚       savedAt: "2025-11-03T10:30:00.000Z"                       â”‚
â”‚     }))                                                         â”‚
â”‚         â†“                                                       â”‚
â”‚     Draft saved silently in background                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. PROCESSING STATUS UPDATES (Parallel to user input)         â”‚
â”‚     ProcessingStatus component monitors uploadState:            â”‚
â”‚                                                                 â”‚
â”‚     T+0s:   "Uploading... 0%"                                   â”‚
â”‚     T+0.5s: "Uploading... 12%"                                  â”‚
â”‚     T+1s:   "Uploading... 27%"                                  â”‚
â”‚     T+1.5s: "Uploading... 43%"                                  â”‚
â”‚     ...                                                         â”‚
â”‚     T+5s:   "Uploading... 100%"                                 â”‚
â”‚     T+5.5s: "Waiting in queue..." (status="queued")             â”‚
â”‚     T+7.5s: "Processing video..." (status="processing")         â”‚
â”‚     T+10.5s: "âœ… Ready to publish" (status="ready")             â”‚
â”‚              Green background, checkmark icon                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15. USER CLICKS "NEXT" BUTTON                                   â”‚
â”‚     handleNext()                                                â”‚
â”‚         â†“                                                       â”‚
â”‚     validateStep(1) // DETAILS step                             â”‚
â”‚         â†“                                                       â”‚
â”‚     Validation checks:                                          â”‚
â”‚     - title not empty? âœ“ YES                                    â”‚
â”‚     - title.trim().length > 0? âœ“ YES                            â”‚
â”‚         â†“                                                       â”‚
â”‚     setErrors({}) // Clear any errors                           â”‚
â”‚         â†“                                                       â”‚
â”‚     setCurrentStep(2) // Move to ELEMENTS                       â”‚
â”‚         â†“                                                       â”‚
â”‚     Framer Motion animation:                                    â”‚
â”‚     - Current content slides out left (opacity 1â†’0, x 0â†’-20)    â”‚
â”‚     - New content slides in from right (opacity 0â†’1, x 20â†’0)    â”‚
â”‚     - Duration: 200ms                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 4: Step 2 - Video Elements**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16. STEP 2 - VIDEO ELEMENTS RENDERS                            â”‚
â”‚                                                                 â”‚
â”‚     Layout:                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  LEFT COLUMN        â”‚  RIGHT COLUMN       â”‚              â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚     â”‚ VideoPreviewPlayer  â”‚ ThumbnailSelector   â”‚              â”‚
â”‚     â”‚ (same as before)    â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”‚              â”‚
â”‚     â”‚                     â”‚ â”‚ 1 â”‚ 2 â”‚ 3 â”‚ + â”‚  â”‚              â”‚
â”‚     â”‚ ProcessingStatus    â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚              â”‚
â”‚     â”‚ "âœ… Ready"           â”‚ (4 thumbnail slots) â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ TrimTool            â”‚              â”‚
â”‚     â”‚                     â”‚ â”â”â”â”â–â–ˆâ–ˆâ–ˆâ–ˆâ–Œâ”â”â”â”      â”‚              â”‚
â”‚     â”‚                     â”‚ Start: 0:05         â”‚              â”‚
â”‚     â”‚                     â”‚ End: 1:30           â”‚              â”‚
â”‚     â”‚                     â”‚ Duration: 1:25      â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚     Tab navigation: [1 Details] [2 Elementsâ€¢] [3 Checks] ...   â”‚
â”‚                      (Element tab is now active/highlighted)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 17. USER SELECTS THUMBNAIL                                      â”‚
â”‚     ThumbnailSelector renders 3 auto-generated thumbnails:      â”‚
â”‚     - Thumbnail 1: frame at 10% (0:15)                          â”‚
â”‚     - Thumbnail 2: frame at 50% (1:15)                          â”‚
â”‚     - Thumbnail 3: frame at 90% (2:15)                          â”‚
â”‚     - Custom upload slot                                        â”‚
â”‚         â†“                                                       â”‚
â”‚     User clicks Thumbnail 2 (middle one)                        â”‚
â”‚         â†“                                                       â”‚
â”‚     onClick={() => onSelect(1)}                                 â”‚
â”‚         â†“                                                       â”‚
â”‚     Parent callback: setMetadata({                              â”‚
â”‚       ...metadata,                                              â”‚
â”‚       thumbnailIndex: 1                                         â”‚
â”‚     })                                                          â”‚
â”‚         â†“                                                       â”‚
â”‚     Component re-renders:                                       â”‚
â”‚     - Thumbnail 2 shows blue border + ring                      â”‚
â”‚     - Blue checkmark overlay appears                            â”‚
â”‚     - Other thumbnails return to gray border                    â”‚
â”‚                                                                 â”‚
â”‚     Alternative: User uploads custom thumbnail                  â”‚
â”‚         â†“                                                       â”‚
â”‚     Clicks upload slot (+ icon)                                 â”‚
â”‚         â†“                                                       â”‚
â”‚     File picker opens                                           â”‚
â”‚         â†“                                                       â”‚
â”‚     User selects image.jpg                                      â”‚
â”‚         â†“                                                       â”‚
â”‚     handleFileSelect(e)                                         â”‚
â”‚         â†“                                                       â”‚
â”‚     Validates: file.type.startsWith("image/")? âœ“                â”‚
â”‚         â†“                                                       â”‚
â”‚     FileReader.readAsDataURL(file)                              â”‚
â”‚         â†“                                                       â”‚
â”‚     setPreviewUrl(dataURL)                                      â”‚
â”‚     onCustomUpload(file)                                        â”‚
â”‚     onSelect(3) // Custom index                                 â”‚
â”‚         â†“                                                       â”‚
â”‚     Custom thumbnail shows with preview                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18. USER TRIMS VIDEO                                            â”‚
â”‚     TrimTool component:                                         â”‚
â”‚     - Video duration: 150s (2:30)                               â”‚
â”‚     - Initial: trimStart=0, trimEnd=150                         â”‚
â”‚         â†“                                                       â”‚
â”‚     User drags START slider to 5s                               â”‚
â”‚         â†“                                                       â”‚
â”‚     onChange event on range input                               â”‚
â”‚         â†“                                                       â”‚
â”‚     handleStartChange(5)                                        â”‚
â”‚         â†“                                                       â”‚
â”‚     Validation: 5 < trimEnd (150)? âœ“ YES                        â”‚
â”‚         â†“                                                       â”‚
â”‚     setStart(5)                                                 â”‚
â”‚     onTrimChange(5, 150)                                        â”‚
â”‚         â†“                                                       â”‚
â”‚     Parent updates: setMetadata({                               â”‚
â”‚       ...metadata,                                              â”‚
â”‚       trimStart: 5,                                             â”‚
â”‚       trimEnd: 150                                              â”‚
â”‚     })                                                          â”‚
â”‚         â†“                                                       â”‚
â”‚     UI updates:                                                 â”‚
â”‚     - Blue selection bar moves to start at 5s                   â”‚
â”‚     - Start label: "0:05"                                       â”‚
â”‚     - Duration label: "2:25"                                    â”‚
â”‚         â†“                                                       â”‚
â”‚     User drags END slider to 90s                                â”‚
â”‚         â†“                                                       â”‚
â”‚     handleEndChange(90)                                         â”‚
â”‚         â†“                                                       â”‚
â”‚     Validation: 90 > trimStart (5)? âœ“ YES                       â”‚
â”‚                90 <= duration (150)? âœ“ YES                      â”‚
â”‚         â†“                                                       â”‚
â”‚     setEnd(90)                                                  â”‚
â”‚     onTrimChange(5, 90)                                         â”‚
â”‚         â†“                                                       â”‚
â”‚     Final trim: 0:05 â†’ 1:30 (85 seconds)                        â”‚
â”‚         â†“                                                       â”‚
â”‚     VideoPreviewPlayer receives new props:                      â”‚
â”‚     - trimStart={5}                                             â”‚
â”‚     - trimEnd={90}                                              â”‚
â”‚         â†“                                                       â”‚
â”‚     Video player respects trim boundaries:                      â”‚
â”‚     - On timeupdate: if (currentTime >= 90) {                   â”‚
â”‚         video.pause()                                           â”‚
â”‚         video.currentTime = 5                                   â”‚
â”‚       }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 19. USER CLICKS "NEXT" â†’ STEP 3                                â”‚
â”‚     handleNext()                                                â”‚
â”‚         â†“                                                       â”‚
â”‚     validateStep(2) // No required fields in Elements           â”‚
â”‚         â†“                                                       â”‚
â”‚     setCurrentStep(3)                                           â”‚
â”‚         â†“                                                       â”‚
â”‚     Framer Motion transition to CHECKS step                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 5: Step 3 - Final Checks**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20. STEP 3 - CHECKS RENDERS                                    â”‚
â”‚                                                                 â”‚
â”‚     Layout:                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  LEFT COLUMN        â”‚  RIGHT COLUMN       â”‚              â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚     â”‚ VideoPreviewPlayer  â”‚ Final Checks        â”‚              â”‚
â”‚     â”‚ (with trim applied) â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ âœ… Title and        â”‚              â”‚
â”‚     â”‚ ProcessingStatus    â”‚    description      â”‚              â”‚
â”‚     â”‚ "âœ… Ready"           â”‚    complete         â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ âœ… Thumbnail        â”‚              â”‚
â”‚     â”‚                     â”‚    selected         â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ âœ… No copyright     â”‚              â”‚
â”‚     â”‚                     â”‚    violations       â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ âœ… Content suitable â”‚              â”‚
â”‚     â”‚                     â”‚    for all ages     â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚     All checks are green (mock validation)                      â”‚
â”‚     User reviews the summary                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 21. USER CLICKS "NEXT" â†’ STEP 4 (FINAL STEP)                   â”‚
â”‚     handleNext()                                                â”‚
â”‚         â†“                                                       â”‚
â”‚     validateStep(3) // No validation needed                     â”‚
â”‚         â†“                                                       â”‚
â”‚     setCurrentStep(4)                                           â”‚
â”‚         â†“                                                       â”‚
â”‚     Transition to VISIBILITY step                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 6: Step 4 - Visibility & Publish**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 22. STEP 4 - VISIBILITY/PUBLISH CONTROLS                       â”‚
â”‚                                                                 â”‚
â”‚     Layout:                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  LEFT COLUMN        â”‚  RIGHT COLUMN       â”‚              â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚     â”‚ VideoPreviewPlayer  â”‚ PublishControls     â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚ ProcessingStatus    â”‚ Visibility:         â”‚              â”‚
â”‚     â”‚ "âœ… Ready"           â”‚ â—‰ Public            â”‚              â”‚
â”‚     â”‚                     â”‚   Everyone can view â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ â—‹ Unlisted          â”‚              â”‚
â”‚     â”‚                     â”‚   Only with link    â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ â—‹ Private           â”‚              â”‚
â”‚     â”‚                     â”‚   Only you          â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ Schedule (optional):â”‚              â”‚
â”‚     â”‚                     â”‚ [Date/Time picker]  â”‚              â”‚
â”‚     â”‚                     â”‚                     â”‚              â”‚
â”‚     â”‚                     â”‚ [ğŸ’¾ Save Draft]     â”‚              â”‚
â”‚     â”‚                     â”‚ [ğŸš€ Publish]        â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚     Footer:                                                     â”‚
â”‚     - "Save Draft" button (left)                                â”‚
â”‚     - "Back" button (now visible, center-right)                 â”‚
â”‚     - "Publish" button replaces "Next" (right)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 23. USER SELECTS VISIBILITY                                     â”‚
â”‚     User clicks "Public" radio button                           â”‚
â”‚         â†“                                                       â”‚
â”‚     onChange event                                              â”‚
â”‚         â†“                                                       â”‚
â”‚     onChange({ ...value, visibility: "public" })                â”‚
â”‚         â†“                                                       â”‚
â”‚     Parent: setMetadata({ ...metadata, visibility: "public" }) â”‚
â”‚         â†“                                                       â”‚
â”‚     Radio button shows checked state                            â”‚
â”‚                                                                 â”‚
â”‚     Optional: User sets schedule                                â”‚
â”‚         â†“                                                       â”‚
â”‚     Selects date: 2025-11-10 15:00                              â”‚
â”‚         â†“                                                       â”‚
â”‚     onChange({ ...value, scheduledAt: "2025-11-10T15:00" })    â”‚
â”‚         â†“                                                       â”‚
â”‚     Publish button text changes to "ğŸ“… Schedule"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 24. USER CLICKS "PUBLISH" BUTTON                                â”‚
â”‚     onClick={handlePublish}                                     â”‚
â”‚         â†“                                                       â”‚
â”‚     handlePublish() in UploadModal                              â”‚
â”‚         â†“                                                       â”‚
â”‚     Check 1: Processing status ready?                           â”‚
â”‚     if (uploadState.processingStatus !== "ready") {             â”‚
â”‚       alert("Please wait for processing to complete!")          â”‚
â”‚       return                                                    â”‚
â”‚     }                                                           â”‚
â”‚     âœ“ Status is "ready" â†’ Continue                              â”‚
â”‚         â†“                                                       â”‚
â”‚     Check 2: All required fields filled?                        â”‚
â”‚     âœ“ Title exists                                              â”‚
â”‚     âœ“ Video processed                                           â”‚
â”‚         â†“                                                       â”‚
â”‚     Clear saved draft:                                          â”‚
â”‚     clearDraft() // Remove from localStorage                    â”‚
â”‚         â†“                                                       â”‚
â”‚     Call completion callback:                                   â”‚
â”‚     onComplete(uploadState.videoId) // "video_1730678401000"    â”‚
â”‚         â†“                                                       â”‚
â”‚     Close modal:                                                â”‚
â”‚     onOpenChange(false)                                         â”‚
â”‚         â†“                                                       â”‚
â”‚     Reset upload state:                                         â”‚
â”‚     uploadState.reset()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **Phase 7: Completion & Cleanup**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 25. PAGE RECEIVES COMPLETION CALLBACK                           â”‚
â”‚     app/upload/page.tsx: handleComplete(videoId)                â”‚
â”‚         â†“                                                       â”‚
â”‚     console.log("Video uploaded:", videoId)                     â”‚
â”‚     // Output: "Video uploaded: video_1730678401000"            â”‚
â”‚         â†“                                                       â”‚
â”‚     In production, would:                                       â”‚
â”‚     - Show success toast notification                           â”‚
â”‚     - Navigate to video page: router.push(`/video/${videoId}`)  â”‚
â”‚     - Or redirect to library: router.push("/library")           â”‚
â”‚     - Send analytics event                                      â”‚
â”‚         â†“                                                       â”‚
â”‚     Modal state updates:                                        â”‚
â”‚     setModalOpen(false)                                         â”‚
â”‚     setSelectedFile(null)                                       â”‚
â”‚         â†“                                                       â”‚
â”‚     Component re-renders:                                       â”‚
â”‚     - Modal unmounts (AnimatePresence exit animation)           â”‚
â”‚     - Returns to initial UploadDropzone view                    â”‚
â”‚     - Ready for next upload                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 26. CLEANUP & MEMORY MANAGEMENT                                 â”‚
â”‚                                                                 â”‚
â”‚     A. VideoPreviewPlayer cleanup:                              â”‚
â”‚        useEffect return (unmount):                              â”‚
â”‚        - Remove video event listeners                           â”‚
â”‚        - Pause video playback                                   â”‚
â”‚        - video.src = ""                                         â”‚
â”‚                                                                 â”‚
â”‚     B. UploadModal cleanup:                                     â”‚
â”‚        useEffect return:                                        â”‚
â”‚        - URL.revokeObjectURL(videoUrl)                          â”‚
â”‚        - Clear timers from useUploadProgress                    â”‚
â”‚        - Clear autosave timeout                                 â”‚
â”‚                                                                 â”‚
â”‚     C. State reset:                                             â”‚
â”‚        - All component states return to initial values          â”‚
â”‚        - Memory freed for next upload                           â”‚
â”‚                                                                 â”‚
â”‚     D. localStorage:                                            â”‚
â”‚        - Draft cleared (if published)                           â”‚
â”‚        - Or kept (if user closed without publishing)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 27. APPLICATION READY FOR NEXT UPLOAD                           â”‚
â”‚     User sees initial upload page again:                        â”‚
â”‚     - Clean UploadDropzone                                      â”‚
â”‚     - "Drop your videos here" message                           â”‚
â”‚     - "Choose Videos" button                                    â”‚
â”‚     - No leftover state from previous upload                    â”‚
â”‚         â†“                                                       â”‚
â”‚     Process can repeat from Phase 1                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Luá»“ng Phá»¥: Error Handling**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR SCENARIO 1: Invalid File Type                             â”‚
â”‚                                                                 â”‚
â”‚ User drops document.pdf into dropzone                           â”‚
â”‚     â†“                                                           â”‚
â”‚ processFiles([document.pdf])                                    â”‚
â”‚     â†“                                                           â”‚
â”‚ validateVideoFile(file)                                         â”‚
â”‚     â†“                                                           â”‚
â”‚ Check: file.type.startsWith("video/")                           â”‚
â”‚     â†“                                                           â”‚
â”‚ âŒ NO â†’ Returns { valid: false, error: "File must be video" }   â”‚
â”‚     â†“                                                           â”‚
â”‚ setError("File must be video")                                  â”‚
â”‚     â†“                                                           â”‚
â”‚ Shows red error box below dropzone                              â”‚
â”‚ "âŒ File must be video"                                         â”‚
â”‚     â†“                                                           â”‚
â”‚ Modal does NOT open                                             â”‚
â”‚ User remains on upload page                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR SCENARIO 2: File Too Large                                â”‚
â”‚                                                                 â”‚
â”‚ User selects video.mp4 (6.5 GB)                                 â”‚
â”‚     â†“                                                           â”‚
â”‚ validateVideoFile(file, 5 * 1024 * 1024 * 1024)                â”‚
â”‚     â†“                                                           â”‚
â”‚ Check: file.size (6.5GB) > maxSizeBytes (5GB)                   â”‚
â”‚     â†“                                                           â”‚
â”‚ âŒ YES â†’ Returns { valid: false, error: "File exceeds 5 GB" }   â”‚
â”‚     â†“                                                           â”‚
â”‚ Shows error in dropzone                                         â”‚
â”‚     â†“                                                           â”‚
â”‚ User must select smaller file                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR SCENARIO 3: Missing Required Field                        â”‚
â”‚                                                                 â”‚
â”‚ User tries to click "Next" on Step 1 without title              â”‚
â”‚     â†“                                                           â”‚
â”‚ handleNext()                                                    â”‚
â”‚     â†“                                                           â”‚
â”‚ validateStep(1)                                                 â”‚
â”‚     â†“                                                           â”‚
â”‚ Check: metadata.title && metadata.title.trim().length > 0       â”‚
â”‚     â†“                                                           â”‚
â”‚ âŒ NO â†’ setErrors({ title: "Title is required" })               â”‚
â”‚     â†“                                                           â”‚
â”‚ return false (validation failed)                                â”‚
â”‚     â†“                                                           â”‚
â”‚ Red error text appears under title input                        â”‚
â”‚ "Title is required"                                             â”‚
â”‚     â†“                                                           â”‚
â”‚ Step does NOT advance                                           â”‚
â”‚ User must fill title before proceeding                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR SCENARIO 4: Processing Not Complete                       â”‚
â”‚                                                                 â”‚
â”‚ User clicks "Publish" while status="processing"                 â”‚
â”‚     â†“                                                           â”‚
â”‚ handlePublish()                                                 â”‚
â”‚     â†“                                                           â”‚
â”‚ Check: uploadState.processingStatus !== "ready"                 â”‚
â”‚     â†“                                                           â”‚
â”‚ âŒ TRUE â†’ alert("Please wait for processing!")                  â”‚
â”‚     â†“                                                           â”‚
â”‚ return (stop execution)                                         â”‚
â”‚     â†“                                                           â”‚
â”‚ Alert shows to user                                             â”‚
â”‚ Publish does NOT proceed                                        â”‚
â”‚ User must wait for "ready" status                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Luá»“ng Phá»¥: Draft Recovery**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DRAFT SCENARIO: User Returns After Closing Mid-Upload           â”‚
â”‚                                                                 â”‚
â”‚ Previous session:                                               â”‚
â”‚ - User filled metadata                                          â”‚
â”‚ - Auto-save triggered                                           â”‚
â”‚ - localStorage saved draft                                      â”‚
â”‚ - User closed browser/tab                                       â”‚
â”‚     â†“                                                           â”‚
â”‚ New session:                                                    â”‚
â”‚ User visits /upload again                                       â”‚
â”‚     â†“                                                           â”‚
â”‚ Selects new video file                                          â”‚
â”‚     â†“                                                           â”‚
â”‚ UploadModal opens                                               â”‚
â”‚     â†“                                                           â”‚
â”‚ useEffect on mount:                                             â”‚
â”‚   if (open && hasDraft()) {                                     â”‚
â”‚     const draft = loadDraft()                                   â”‚
â”‚     if (confirm("We found a saved draft. Restore?")) {          â”‚
â”‚       setMetadata(draft)                                        â”‚
â”‚     }                                                           â”‚
â”‚   }                                                             â”‚
â”‚     â†“                                                           â”‚
â”‚ Browser shows confirm dialog:                                   â”‚
â”‚ "We found a saved draft for this video."                        â”‚
â”‚ [Restore Draft] [Discard]                                       â”‚
â”‚     â†“                                                           â”‚
â”‚ If user clicks "Restore Draft":                                 â”‚
â”‚     â†“                                                           â”‚
â”‚ loadDraft() retrieves from localStorage                         â”‚
â”‚     â†“                                                           â”‚
â”‚ setMetadata(draft) restores:                                    â”‚
â”‚ - title: "Amazing Cooking Tutorial"                             â”‚
â”‚ - description: "Learn how to..."                                â”‚
â”‚ - tags: ["cooking", "tutorial"]                                 â”‚
â”‚ - category: "education"                                         â”‚
â”‚ - etc.                                                          â”‚
â”‚     â†“                                                           â”‚
â”‚ Form fields populate with saved data                            â”‚
â”‚ User can continue where they left off                           â”‚
â”‚     â†“                                                           â”‚
â”‚ If user clicks "Discard":                                       â”‚
â”‚     â†“                                                           â”‚
â”‚ clearDraft() removes from localStorage                          â”‚
â”‚ Fresh form with empty fields                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Timeline View: Complete Upload Flow**

```
Time    Status                  Component               Action
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0:00    Page Load              UploadPage              Render dropzone
0:05    File Selected          UploadDropzone          Validate file
0:06    Modal Open             UploadModal             Initialize hooks
0:06    Upload Start           useUploadProgress       progress: 0%
0:06    Object URL Created     UploadModal             Set videoUrl
0:07    Auto-save Check        useAutosave             Check draft
0:10    Step 1 Render          MetadataForm            Show form fields

        [User fills form - 30 seconds]

0:40    Title Entered          MetadataForm            "Amazing Cooking..."
0:42    Auto-save Triggered    useAutosave             Save to localStorage
0:50    Tags Added             MetadataForm            ["cooking", "tutorial"]
1:00    Category Selected      MetadataForm            "education"

        [Meanwhile, upload progresses in background]

0:07    Upload Progress        ProcessingStatus        15%
0:08    Upload Progress        ProcessingStatus        32%
0:09    Upload Progress        ProcessingStatus        58%
0:10    Upload Progress        ProcessingStatus        85%
0:11    Upload Complete        ProcessingStatus        100%
0:11    Status: Queued         ProcessingStatus        "Waiting..."
0:13    Status: Processing     ProcessingStatus        "Processing..."
0:16    Status: Ready          ProcessingStatus        "âœ… Ready"

1:10    Next Clicked           UploadModal             Validate â†’ Step 2
1:12    Step 2 Render          ThumbnailSelector       Show thumbnails
                                TrimTool                Show trim slider

        [User customizes - 20 seconds]

1:15    Thumbnail Selected     ThumbnailSelector       Index: 1
1:25    Trim Adjusted          TrimTool                5s â†’ 90s
1:30    Next Clicked           UploadModal             â†’ Step 3
1:32    Step 3 Render          Checks                  Show checklist
1:35    Next Clicked           UploadModal             â†’ Step 4
1:37    Step 4 Render          PublishControls         Show visibility
1:40    Public Selected        PublishControls         visibility: "public"
1:45    Publish Clicked        UploadModal             handlePublish()
1:45    Draft Cleared          useAutosave             Remove localStorage
1:45    Callback Fired         UploadPage              handleComplete()
1:45    Modal Close            UploadModal             Cleanup & unmount
1:46    Success State          UploadPage              Ready for next upload
```

---

### **Data Flow Summary**

```
FILE SELECTION
    â†“
VALIDATION (lib/utils.ts)
    â†“
PAGE STATE UPDATE (page.tsx)
    â†“
MODAL OPENS (UploadModal.tsx)
    â”œâ†’ VIDEO URL CREATION
    â”œâ†’ HOOKS INITIALIZATION
    â”‚   â”œâ†’ useAutosave (localStorage)
    â”‚   â””â†’ useUploadProgress (mock upload)
    â””â†’ COMPONENT TREE RENDER
        â”œâ†’ VideoPreviewPlayer (left)
        â”œâ†’ ProcessingStatus (left bottom)
        â””â†’ Step Components (right)
            â”œâ†’ Step 1: MetadataForm
            â”œâ†’ Step 2: ThumbnailSelector + TrimTool
            â”œâ†’ Step 3: Checks List
            â””â†’ Step 4: PublishControls
    â†“
USER INTERACTIONS
    â”œâ†’ Form inputs â†’ metadata state
    â”œâ†’ Auto-save â†’ localStorage
    â”œâ†’ Upload progress â†’ uploadState
    â””â†’ Step navigation â†’ currentStep
    â†“
VALIDATION
    â”œâ†’ Per-step validation
    â”œâ†’ Required field checks
    â””â†’ Processing status check
    â†“
PUBLISH
    â”œâ†’ Clear draft
    â”œâ†’ Fire callback
    â””â†’ Close modal
    â†“
CLEANUP
    â”œâ†’ Revoke object URLs
    â”œâ†’ Clear timers
    â””â†’ Reset states
    â†“
READY FOR NEXT UPLOAD
```

---

### **2ï¸âƒ£ COMPONENT LAYER** (`components/upload/*`)

#### **A. UploadDropzone** - File selection component

**Input:**

- `onFilesSelected: (files: File[]) => void`
- `accept: string`
- `maxSizeBytes: number`

**Output:**

- Gá»i callback `onFilesSelected(files)` khi user chá»n file

**Flow:**

```typescript
User drags file into dropzone
    â†“
handleDragEnter() â†’ setIsDragging(true)
    â†“
handleDrop() â†’ e.dataTransfer.files
    â†“
processFiles(files)
    â†“
validateVideoFile(file) [tá»« lib/utils.ts]
    â†“
Valid?
  âœ… Yes â†’ onFilesSelected([file])
  âŒ No  â†’ setError(message)
```

**Dependencies:**

- `lib/utils.ts` â†’ `validateVideoFile()`
- `react-icons/fi` â†’ Icons

---

#### **B. UploadModal** - Main upload flow orchestrator

**Vai trÃ²:** Quáº£n lÃ½ toÃ n bá»™ flow upload vá»›i 4 steps

**State internal:**

```typescript
// Step management
const [currentStep, setCurrentStep] = useState(1); // 1-4

// Video data
const [videoUrl, setVideoUrl] = useState<string | null>(null);
const [videoDuration, setVideoDuration] = useState(0);

// Metadata
const [metadata, setMetadata] = useState<Partial<VideoMetadata>>({
  title: "",
  description: "",
  tags: [],
  category: "",
  language: "vi",
  // ... more fields
});

// Validation
const [errors, setErrors] = useState<Record<string, string>>({});
```

**Hooks usage:**

```typescript
// Autosave hook
const {saveDraft, loadDraft, clearDraft, hasDraft} =
  useAutosave("video-upload-draft");

// Upload progress hook
const uploadState = useUploadProgress();
// Returns: {
//   uploadProgress,
//   processingStatus,
//   uploadId,
//   videoId,
//   error,
//   startUpload(),
//   retryUpload(),
//   reset()
// }
```

**Flow diagram:**

```
Modal opens with videoFile
    â†“
useEffect: Create object URL
    â†“
videoUrl = URL.createObjectURL(videoFile)
    â†“
uploadState.startUpload(videoFile) [Hook call]
    â†“
[Step 1] Details
  - MetadataForm component
  - User fills title, description, tags
  - validateStep() on Next click
    â†“
[Step 2] Elements
  - ThumbnailSelector
  - TrimTool
  - User customizes thumbnails & trim points
    â†“
[Step 3] Checks
  - Show validation checklist
  - Confirm content policies
    â†“
[Step 4] Visibility
  - PublishControls
  - Select public/private/unlisted
  - Schedule (optional)
  - Click Publish
    â†“
handlePublish()
  - Check if processingStatus === "ready"
  - clearDraft()
  - onComplete(videoId)
```

**Component tree:**

```
UploadModal
â”œâ”€â”€ UploadProgressHeader (shows current step)
â”œâ”€â”€ VideoPreviewPlayer (left side)
â”œâ”€â”€ ProcessingStatus (below video)
â””â”€â”€ Right side (changes per step):
    â”œâ”€â”€ Step 1: MetadataForm
    â”œâ”€â”€ Step 2: ThumbnailSelector + TrimTool
    â”œâ”€â”€ Step 3: Checks list
    â””â”€â”€ Step 4: PublishControls
```

---

#### **C. MetadataForm** - Form fields component

**Props:**

- `value: Partial<VideoMetadata>`
- `onChange: (metadata) => void`
- `errors?: Record<string, string>`

**Flow:**

```
User types in title input
    â†“
onChange event
    â†“
handleChange("title", value)
    â†“
Call parent onChange({ ...value, title: newValue })
    â†“
Parent updates metadata state
    â†“
Component re-renders with new value
```

**Features:**

- Title with character counter (max 100)
- Description with counter (max 5000)
- Tags as chips with autocomplete suggestions
- Category & Language dropdowns
- Toggles for comments & playlist

---

#### **D. ThumbnailSelector** - Thumbnail picker

**Flow:**

```
Component renders 3 auto thumbnails + upload button
    â†“
User clicks thumbnail
    â†“
onSelect(index)
    â†“
Parent updates metadata.thumbnailIndex
    â†“
Selected thumbnail shows checkmark
```

**Custom upload:**

```
User clicks "Upload" thumbnail slot
    â†“
File input opens
    â†“
User selects image
    â†“
FileReader reads file
    â†“
setPreviewUrl(dataURL)
    â†“
onCustomUpload(file)
    â†“
onSelect(3) // Custom index
```

---

#### **E. TrimTool** - Video trimming

**Props:**

- `duration: number` (video duration)
- `trimStart?: number`
- `trimEnd?: number`
- `onTrimChange: (start, end) => void`

**Flow:**

```
User drags start slider
    â†“
handleStartChange(value)
    â†“
Validate: start < end
    â†“
setStart(newStart)
    â†“
onTrimChange(newStart, end)
    â†“
Parent updates metadata.trimStart/trimEnd
    â†“
VideoPreviewPlayer receives new trim values
    â†“
Video playback respects trim boundaries
```

---

#### **F. VideoPreviewPlayer** - Video display

**Flow:**

```
Component mounts with videoUrl
    â†“
useEffect: Add event listeners
  - loadedmetadata â†’ setDuration()
  - timeupdate â†’ setCurrentTime(), onTimeUpdate()
  - play/pause â†’ setIsPlaying()
    â†“
If trimEnd && currentTime >= trimEnd
    â†“
video.pause()
video.currentTime = trimStart
```

---

#### **G. ProcessingStatus** - Upload status display

**Props from hook:**

- `status: "uploading" | "queued" | "processing" | "ready" | "error"`
- `uploadProgress: number`
- `error?: string`
- `onRetry?: () => void`

**Conditional rendering:**

```typescript
status === "uploading"
  â†’ Show progress bar + percentage

status === "queued"
  â†’ Show "Waiting in queue..."

status === "processing"
  â†’ Show "Processing video..."

status === "ready"
  â†’ Show "âœ… Ready to publish"

status === "error"
  â†’ Show error + Retry button
```

---

#### **H. PublishControls** - Final publish step

**Flow:**

```
User selects visibility radio
    â†“
onChange({ ...value, visibility: "public" })
    â†“
User picks datetime (optional)
    â†“
onChange({ ...value, scheduledAt: datetime })
    â†“
User clicks "Save Draft"
    â†“
onSaveDraft() â†’ calls saveDraft(metadata) from hook
    â†“
OR User clicks "Publish"
    â†“
onPublish()
  â†“
  Check canPublish (processingStatus === "ready")
  â†“
  Call API (mock) with metadata
  â†“
  onComplete(videoId)
```

---

### **3ï¸âƒ£ HOOK LAYER** (`lib/hooks.ts`)

#### **A. useAutosave Hook**

**Purpose:** Save/load draft from localStorage

**API:**

```typescript
const { saveDraft, loadDraft, clearDraft, hasDraft } = useAutosave(key: string);
```

**Implementation:**

```typescript
export function useAutosave(key: string) {
  const saveDraft = useCallback(
    (metadata: Partial<VideoMetadata>) => {
      localStorage.setItem(
        key,
        JSON.stringify({
          ...metadata,
          savedAt: new Date().toISOString(),
        })
      );
    },
    [key]
  );

  const loadDraft = useCallback(() => {
    const saved = localStorage.getItem(key);
    return saved ? JSON.parse(saved) : null;
  }, [key]);

  const clearDraft = useCallback(() => {
    localStorage.removeItem(key);
  }, [key]);

  const hasDraft = useCallback(() => {
    return localStorage.getItem(key) !== null;
  }, [key]);

  return {saveDraft, loadDraft, clearDraft, hasDraft};
}
```

**Usage in UploadModal:**

```typescript
// Load draft on mount
useEffect(() => {
  if (open && hasDraft()) {
    const draft = loadDraft();
    if (draft && confirm("Restore draft?")) {
      setMetadata(draft);
    }
  }
}, [open]);

// Auto-save every 2 seconds
useEffect(() => {
  if (open && metadata.title) {
    const timer = setTimeout(() => {
      saveDraft(metadata);
    }, 2000);
    return () => clearTimeout(timer);
  }
}, [metadata, open]);
```

---

#### **B. useUploadProgress Hook**

**Purpose:** Simulate upload & processing with state management

**State:**

```typescript
interface UploadState {
  uploadProgress: number; // 0-100
  processingStatus:
    | "idle"
    | "uploading"
    | "queued"
    | "processing"
    | "ready"
    | "error";
  uploadId: string | null; // Mock upload ID
  videoId: string | null; // Mock video ID
  error: string | null;
}
```

**Flow:**

```typescript
startUpload(file)
    â†“
setState({ processingStatus: "uploading", uploadProgress: 0 })
    â†“
setInterval: Increment progress randomly
    â†“
When progress >= 100:
    â†“
    setState({ processingStatus: "queued", videoId: "video_xxx" })
    â†“
    setTimeout 2s â†’ processingStatus = "processing"
    â†“
    setTimeout 3s â†’ processingStatus = "ready"
```

**Mock implementation:**

```typescript
export function useUploadProgress() {
  const [state, setState] = useState<UploadState>({
    uploadProgress: 0,
    processingStatus: "idle",
    uploadId: null,
    videoId: null,
    error: null,
  });

  const startUpload = useCallback((file: File) => {
    const uploadId = `upload_${Date.now()}`;
    setState({
      uploadProgress: 0,
      processingStatus: "uploading",
      uploadId,
      videoId: null,
      error: null,
    });

    // Simulate upload progress
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);

        // Transition through processing stages
        setTimeout(() => {
          setState((prev) => ({
            ...prev,
            uploadProgress: 100,
            processingStatus: "queued",
            videoId: `video_${Date.now()}`,
          }));

          setTimeout(() => {
            setState((prev) => ({...prev, processingStatus: "processing"}));

            setTimeout(() => {
              setState((prev) => ({...prev, processingStatus: "ready"}));
            }, 3000);
          }, 2000);
        }, 500);
      }

      setState((prev) => ({...prev, uploadProgress: Math.min(progress, 100)}));
    }, 500);
  }, []);

  const retryUpload = useCallback(() => {
    setState((prev) => ({
      ...prev,
      error: null,
      processingStatus: "uploading",
      uploadProgress: 0,
    }));
  }, []);

  const reset = useCallback(() => {
    setState({
      uploadProgress: 0,
      processingStatus: "idle",
      uploadId: null,
      videoId: null,
      error: null,
    });
  }, []);

  return {...state, startUpload, retryUpload, reset};
}
```

---

### **4ï¸âƒ£ LIB/UTILS LAYER** (`lib/utils.ts`)

**Purpose:** Pure utility functions, no side effects

#### **A. cn() - Tailwind class merger**

```typescript
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

**Usage:**

```typescript
<div
  className={cn("base-class", isActive && "active-class", "conditional-class")}
/>
```

---

#### **B. formatFileSize() - Format bytes**

```typescript
export function formatFileSize(bytes: number): string {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i];
}
```

**Example:**

```typescript
formatFileSize(1024); // "1 KB"
formatFileSize(1048576); // "1 MB"
formatFileSize(5368709120); // "5 GB"
```

---

#### **C. formatDuration() - Format seconds to MM:SS**

```typescript
export function formatDuration(seconds: number): string {
  const hrs = Math.floor(seconds / 3600);
  const mins = Math.floor((seconds % 3600) / 60);
  const secs = Math.floor(seconds % 60);

  if (hrs > 0) {
    return `${hrs}:${mins.toString().padStart(2, "0")}:${secs
      .toString()
      .padStart(2, "0")}`;
  }
  return `${mins}:${secs.toString().padStart(2, "0")}`;
}
```

**Example:**

```typescript
formatDuration(65); // "1:05"
formatDuration(3665); // "1:01:05"
formatDuration(45); // "0:45"
```

---

#### **D. validateVideoFile() - File validation**

```typescript
export function validateVideoFile(
  file: File,
  maxSizeBytes: number = 5 * 1024 * 1024 * 1024
): {valid: boolean; error?: string} {
  // Check file type
  if (!file.type.startsWith("video/")) {
    return {valid: false, error: "File pháº£i lÃ  video"};
  }

  // Check file size
  if (file.size > maxSizeBytes) {
    return {
      valid: false,
      error: `File vÆ°á»£t quÃ¡ ${formatFileSize(maxSizeBytes)}`,
    };
  }

  return {valid: true};
}
```

**Usage:**

```typescript
const validation = validateVideoFile(file, 5 * 1024 * 1024 * 1024);
if (!validation.valid) {
  setError(validation.error);
  return;
}
// Proceed with upload
```

---

## ğŸ”„ Complete Data Flow Example

### Scenario: User uploads video tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i

```
1. User visits /upload
   â†“
   ğŸ“„ app/upload/page.tsx renders
   â””â”€ State: selectedFile=null, modalOpen=false

2. User drags video.mp4 into dropzone
   â†“
   ğŸ¨ UploadDropzone receives drop event
   â”œâ”€ processFiles([video.mp4])
   â”œâ”€ ğŸ“š validateVideoFile(file, maxSize) [lib/utils]
   â”‚  â””â”€ Returns: { valid: true }
   â””â”€ onFilesSelected([video.mp4]) [callback to page]

3. Page receives file
   â†“
   ğŸ“„ page.tsx: handleFilesSelected()
   â”œâ”€ setSelectedFile(video.mp4)
   â””â”€ setModalOpen(true)

4. UploadModal opens
   â†“
   ğŸ¨ UploadModal component mounts
   â”œâ”€ useEffect: videoUrl = URL.createObjectURL(video.mp4)
   â”œâ”€ ğŸ”§ useUploadProgress() hook
   â”‚  â””â”€ startUpload(video.mp4)
   â”‚     â””â”€ Mock upload starts: progress 0 â†’ 100
   â”œâ”€ ğŸ”§ useAutosave() hook
   â”‚  â””â”€ Check localStorage for draft
   â””â”€ Render Step 1 (Details)

5. User fills form (Step 1)
   â†“
   ğŸ¨ MetadataForm receives input
   â”œâ”€ User types title: "My Video"
   â”œâ”€ onChange("title", "My Video")
   â”œâ”€ handleMetadataChange({ ...metadata, title: "My Video" })
   â””â”€ Parent state updates

   Auto-save triggered:
   â†“
   ğŸ”§ useAutosave: saveDraft(metadata)
   â””â”€ localStorage.setItem("video-upload-draft", JSON.stringify(metadata))

6. User clicks "Next"
   â†“
   ğŸ¨ UploadModal: handleNext()
   â”œâ”€ validateStep(1)
   â”‚  â””â”€ Check: title not empty? âœ…
   â”œâ”€ setCurrentStep(2)
   â””â”€ Render Step 2 (Elements)

7. Step 2: Elements
   â†“
   ğŸ¨ ThumbnailSelector
   â”œâ”€ User selects thumbnail #2
   â”œâ”€ onSelect(1)
   â””â”€ Parent: setMetadata({ ...metadata, thumbnailIndex: 1 })

   ğŸ¨ TrimTool
   â”œâ”€ User drags slider: start=5s, end=60s
   â”œâ”€ ğŸ“š formatDuration(5) â†’ "0:05" [lib/utils]
   â”œâ”€ onTrimChange(5, 60)
   â””â”€ Parent: setMetadata({ ...metadata, trimStart: 5, trimEnd: 60 })

   ğŸ¨ VideoPreviewPlayer re-renders
   â””â”€ Respects new trim values

8. User clicks "Next" â†’ Step 3 (Checks)
   â†“
   Shows validation checklist

9. User clicks "Next" â†’ Step 4 (Visibility)
   â†“
   ğŸ¨ PublishControls renders
   â”œâ”€ User selects "Public"
   â”œâ”€ onChange({ ...metadata, visibility: "public" })
   â””â”€ User clicks "Publish"

10. Publish flow
    â†“
    ğŸ¨ UploadModal: handlePublish()
    â”œâ”€ Check: uploadState.processingStatus === "ready" âœ…
    â”œâ”€ ğŸ”§ clearDraft() [hook]
    â”‚  â””â”€ localStorage.removeItem("video-upload-draft")
    â”œâ”€ onComplete(videoId) [callback to page]
    â””â”€ Modal closes

11. Success!
    â†“
    ğŸ“„ page.tsx: handleComplete("video_123")
    â””â”€ console.log("Video uploaded: video_123")
       (In real app: Navigate to video page or show success toast)
```

---

## ğŸ¯ Best Practices & Patterns

### **1. Separation of Concerns**

```
Page:       Routing & high-level orchestration
Components: UI presentation & user interactions
Hooks:      Business logic & side effects
Utils:      Pure functions & helpers
```

### **2. Data Flow: Unidirectional**

```
State flows down (props)
Events flow up (callbacks)
```

### **3. Component Communication**

```typescript
// âŒ Bad: Direct sibling communication
<ComponentA onEvent={(data) => componentBRef.current.update(data)} />

// âœ… Good: Lift state up
<Parent>
  <ComponentA onChange={setState} />
  <ComponentB value={state} />
</Parent>
```

### **4. Hook Reusability**

```typescript
// Hooks can be used in multiple components
function ComponentA() {
  const {saveDraft} = useAutosave("component-a");
}

function ComponentB() {
  const {saveDraft} = useAutosave("component-b");
}
```

### **5. Pure Utils**

```typescript
// âœ… Good: Pure function
export function formatDuration(seconds: number): string {
  // No side effects, predictable output
}

// âŒ Bad: Impure function
export function formatDuration(seconds: number): string {
  console.log(seconds); // Side effect!
  return formatTime(seconds);
}
```

---

## ğŸ“ Type Definitions

### Core Types:

```typescript
// lib/hooks.ts
export interface VideoMetadata {
  title: string;
  description: string;
  tags: string[];
  category: string;
  language: string;
  allowComments: boolean;
  addToPlaylist: boolean;
  visibility: "public" | "unlisted" | "private";
  scheduledAt?: string;
  thumbnailIndex: number;
  customThumbnail?: File;
  trimStart?: number;
  trimEnd?: number;
}

export interface UploadState {
  uploadProgress: number;
  processingStatus:
    | "idle"
    | "uploading"
    | "queued"
    | "processing"
    | "ready"
    | "error";
  uploadId: string | null;
  videoId: string | null;
  error: string | null;
}
```

---

## ğŸ§ª Testing Strategy

### Page Level:

```typescript
// Test routing, initial state, integration
test("renders upload page with dropzone", () => {
  render(<UploadPage />);
  expect(screen.getByText("Táº£i video lÃªn")).toBeInTheDocument();
});
```

### Component Level:

```typescript
// Test UI interactions, prop passing
test("UploadDropzone validates file type", () => {
  const onFilesSelected = jest.fn();
  render(<UploadDropzone onFilesSelected={onFilesSelected} />);
  // Simulate file drop...
});
```

### Hook Level:

```typescript
// Test business logic in isolation
test("useUploadProgress transitions states correctly", () => {
  const {result} = renderHook(() => useUploadProgress());
  act(() => result.current.startUpload(mockFile));
  expect(result.current.processingStatus).toBe("uploading");
});
```

### Utils Level:

```typescript
// Test pure functions
test("formatDuration formats seconds correctly", () => {
  expect(formatDuration(65)).toBe("1:05");
  expect(formatDuration(3665)).toBe("1:01:05");
});
```

---

## ğŸš€ Future Enhancements

1. **Real API Integration**

   - Replace mock upload with actual API calls
   - Add retry logic with exponential backoff
   - Implement resumable uploads (tus protocol)

2. **Advanced Features**

   - Client-side thumbnail extraction from video
   - Video compression before upload
   - Real-time progress via WebSocket
   - Batch upload support

3. **State Management**

   - Consider Zustand/Redux for complex state
   - Add optimistic UI updates
   - Implement undo/redo

4. **Performance**
   - Lazy load components
   - Virtualize large lists
   - Debounce autosave
   - Memoize expensive calculations

---

## ğŸ“š Further Reading

- [Next.js App Router](https://nextjs.org/docs/app)
- [React Hooks](https://react.dev/reference/react)
- [shadcn/ui](https://ui.shadcn.com/)
- [Radix UI Primitives](https://www.radix-ui.com/primitives)
- [Tailwind CSS](https://tailwindcss.com/)

---

> ğŸ“ **Note**: ÄÃ¢y lÃ  UI-only implementation vá»›i mock data. Trong production, cáº§n thay tháº¿ mock logic báº±ng real API calls vÃ  proper error handling.
